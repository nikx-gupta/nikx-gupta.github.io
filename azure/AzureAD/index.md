---
title: Azure Active Directory (AAD)
---

### Service Requirements
- Self Service Password Reset `SSPR`
  - `Free, Trial` - Only works for `Cloud` users
  - `P1 required` - For Enabling `On-Premises` password writeback
  - By default, `administrator` accounts are enabled for SSPR, and a strong default two-gate password reset policy is enforced
- Multi Factor Authentication
  - `P1` required
- Conditional Access Policies
  - `P1` required
- Risk based Sign-In Protection
  - `P2 or P2 Trial` needed

![Center_300](/assets/images/sspr_01.png)
  
### Topics
- ### [Add MultiFactor Authentication for Users](AddMultiFactorAuth)
- ### [Role Based Authorization (RBAC) using AppService](RoleBasedAuth)
- ### [WebApp with AzureAD SingleSignOn](WebAppSingleSignOn)
- ### Conditional Access Policies
    - [Policy when user logged from IP Address or Locations](CondAccessNamedLocation)
- ### Privileged Identity Management
    - [Access Review](AccessReviewProgram)
- ### [TODO - Using Managed Identity with AppService and KeyVault](CreateIdentityWebApp)
- ### [Apply Access Policy based on Named Locations](CondAccessNamedLocation)

### Managed Identities
- `System Assigned` - Created and Managed by Azure. Eg. like Virtual Machine Identity
- `User Assigned`- Managed by User
- `Components of Managed Identity`
    - `ClientID` - Generated by Azure AD. Relationship between Resource and Service Principal
    - `Principal ID` - Used by RBAC to grant Access to the resource
    - `Azure Instance Metadata Service (IMDS)` - Used inside Azure VM by applications to request OAuth Access token

### Commands
- ### Create User
```powershell
$password =  ConvertTo-SecureString -string "Home0580" -AsPlainText -Force
New-AzADUser -DisplayName "dev01" -Password $password -UserPrincipalName "dev01@nikxlab01.onmicrosoft.com" `
    -MailNickName "dev01
```
```azurecli
az ad user create --display-name "dev_device_admin" --password Home0580 --user-principal-name dev_device_admin@cloudx-labs.in
```

- ### Get User
```powershell
Get-AzureADUser -Filter "startswith(displayName, 'test')"
Get-AzADUser -UserPrincipalName dev01@nikxlab01.onmicrosoft.com
```

- ### Group
```powershell
New-AzADGroup -DisplayName NetworkGroup -MailEnabled $false -SecurityEnabled $true
Get-AzADGroup | Select-Object DisplayName
Add-AzADGroupMember -MemberUserPrincipalName "dev01@nikxlab01.onmicrosoft.com" -TargetGroupObject (Get-AzADGroup -DisplayName "")
```

- ### Roles
```azurecli
az role definition list --query "[*].roleName"
az role definition list --query "[].[roleName, permissions]"
az role definition list --query "[].{r:roleName,P:permissions}"
az role definition list --query "[?contains(roleName, 'Network Contributor')]"
az role definition list --query "[].{r:roleName,P:permissions} | [?r=='Network Contributor'] | [].[p[*].actions]"
```
```powershell
Get-AzRoleDefinition | Format-Table Actions, NotActions
```

- ### Assign Roles
```azurecli
az account list --query "[?name=='LAB-DEV'] | [0].id"
az role assignment create --assignee dev_network_cont@cloudx-labs.in --role "Network Contributor" --scope /subscriptions/9a2b97de-8038-4a49-805b-966754be4662
```

### References
- ### [Enable Password Writeback](https://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-sspr-writeback)
 
    



